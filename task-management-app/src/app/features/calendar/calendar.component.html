<div class="calendar-container">
  <div class="calendar-header">
    <button mat-icon-button (click)="goToPrevious()">
      <mat-icon>chevron_left</mat-icon>
    </button>
    <h2 *ngIf="viewMode === 'month'">{{ currentMonth | date:'yyyy年MM月' }}</h2>
    <h2 *ngIf="viewMode === 'week'">{{ selectedDate | date:'yyyy年MM月d日' }} の週</h2>
    <h2 *ngIf="viewMode === 'day'">{{ selectedDate | date:'yyyy年MM月d日' }}</h2>
    <button mat-icon-button (click)="goToNext()">
      <mat-icon>chevron_right</mat-icon>
    </button>
    <div class="view-switch">
      <button mat-button [color]="viewMode === 'month' ? 'primary' : ''" (click)="setViewMode('month')">月</button>
      <button mat-button [color]="viewMode === 'week' ? 'primary' : ''" (click)="setViewMode('week')">週</button>
      <button mat-button [color]="viewMode === 'day' ? 'primary' : ''" (click)="setViewMode('day')">日</button>
    </div>
  </div>

  <div class="calendar-filters">
    <mat-form-field appearance="fill" class="filter-field">
      <mat-label>ステータス</mat-label>
      <mat-select [(ngModel)]="filterStatus">
        <mat-option value="">すべて</mat-option>
        <mat-option value="未着手">未着手</mat-option>
        <mat-option value="進行中">進行中</mat-option>
        <mat-option value="完了">完了</mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field appearance="fill" class="filter-field">
      <mat-label>重要度</mat-label>
      <mat-select [(ngModel)]="filterImportance">
        <mat-option value="">すべて</mat-option>
        <mat-option value="高">高</mat-option>
        <mat-option value="中">中</mat-option>
        <mat-option value="低">低</mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field appearance="fill" class="filter-field">
      <mat-label>担当者</mat-label>
      <mat-select [(ngModel)]="filterAssignee">
        <mat-option value="">すべて</mat-option>
        <mat-option *ngFor="let assignee of assigneeList" [value]="assignee">{{ assignee }}</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <!-- 月表示 -->
  <ng-container *ngIf="viewMode === 'month'">
    <div class="weekday-header">
      <div *ngFor="let day of weekDays" class="weekday">{{ day }}</div>
    </div>
    <div class="calendar-body">
      <div *ngFor="let week of weeks" class="week">
        <div *ngFor="let date of week" 
             class="day-cell"
             [class.today]="isToday(date)"
             [class.other-month]="!isCurrentMonth(date)"
             cdkDropList
             (cdkDropListDropped)="onTaskDrop($event, date)">
          <div class="date-number">{{ date.getDate() }}</div>
          <div class="task-list">
            <div *ngFor="let task of getTasksForDate(date)"
                 class="task-card"
                 [class.status-not-started]="task.status === '未着手'"
                 [class.status-in-progress]="task.status === '進行中'"
                 [class.status-completed]="task.status === '完了'"
                 [class.priority-high]="task.importance === '高'"
                 [class.priority-medium]="task.importance === '中'"
                 [class.priority-low]="task.importance === '低'"
                 cdkDrag
                 (click)="openTaskDetail(task)">
              <div class="task-title">{{ task.title }}</div>
              <div class="task-meta">
                <span class="task-status">{{ task.status }}</span>
                <span class="task-priority">{{ task.importance }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- 週表示 -->
  <ng-container *ngIf="viewMode === 'week'">
    <div class="weekday-header">
      <div *ngFor="let day of weekDays" class="weekday">{{ day }}</div>
    </div>
    <div class="calendar-body">
      <div class="week">
        <div *ngFor="let date of getCurrentWeek()" 
             class="day-cell"
             [class.today]="isToday(date)"
             cdkDropList
             (cdkDropListDropped)="onTaskDrop($event, date)">
          <div class="date-number">{{ date.getDate() }}</div>
          <div class="task-list">
            <div *ngFor="let task of getTasksForDate(date)"
                 class="task-card"
                 [class.status-not-started]="task.status === '未着手'"
                 [class.status-in-progress]="task.status === '進行中'"
                 [class.status-completed]="task.status === '完了'"
                 [class.priority-high]="task.importance === '高'"
                 [class.priority-medium]="task.importance === '中'"
                 [class.priority-low]="task.importance === '低'"
                 cdkDrag
                 (click)="openTaskDetail(task)">
              <div class="task-title">{{ task.title }}</div>
              <div class="task-meta">
                <span class="task-status">{{ task.status }}</span>
                <span class="task-priority">{{ task.importance }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- 日表示 -->
  <ng-container *ngIf="viewMode === 'day'">
    <div class="day-view">
      <h3>{{ selectedDate | date:'yyyy年MM月d日 (EEE)' }}</h3>
      <div class="task-list">
        <div *ngFor="let task of getTasksForDay()"
             class="task-card"
             [class.status-not-started]="task.status === '未着手'"
             [class.status-in-progress]="task.status === '進行中'"
             [class.status-completed]="task.status === '完了'"
             [class.priority-high]="task.importance === '高'"
             [class.priority-medium]="task.importance === '中'"
             [class.priority-low]="task.importance === '低'"
             cdkDrag
             (click)="openTaskDetail(task)">
          <div class="task-title">{{ task.title }}</div>
          <div class="task-meta">
            <span class="task-status">{{ task.status }}</span>
            <span class="task-priority">{{ task.importance }}</span>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</div> 