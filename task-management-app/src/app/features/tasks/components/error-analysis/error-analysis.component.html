<!-- エラー分析チャート -->
<div class="charts-container" *ngIf="!loading && !error">
  <div class="chart-actions">
    <form [formGroup]="analysisForm" (ngSubmit)="loadErrorAnalysis()" class="date-range-form">
      <mat-form-field>
        <mat-label>開始日</mat-label>
        <input matInput [matDatepicker]="startPicker" formControlName="startDate">
        <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
        <mat-datepicker #startPicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field>
        <mat-label>終了日</mat-label>
        <input matInput [matDatepicker]="endPicker" formControlName="endDate">
        <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
        <mat-datepicker #endPicker></mat-datepicker>
      </mat-form-field>

      <button mat-button type="submit" [disabled]="loading">
        <mat-icon>refresh</mat-icon>
        更新
      </button>

      <button mat-button type="button" (click)="exportToCSV()">
        <mat-icon>download</mat-icon>
        CSVエクスポート
      </button>
    </form>
  </div>

  <div class="chart">
    <h3>エラー発生率の推移</h3>
    <canvas baseChart
      [data]="errorTrendChartData"
      [options]="errorTrendChartOptions"
      type="line">
    </canvas>
  </div>
  <div class="chart">
    <h3>エラータイプ分布</h3>
    <canvas baseChart
      [data]="errorTypeChartData"
      [options]="errorTypeChartOptions"
      type="pie"
      (chartClick)="onChartClick($event, 'errorType')">
    </canvas>
  </div>
  <div class="chart">
    <h3>時間帯別エラー発生数</h3>
    <canvas baseChart
      [data]="hourlyErrorChartData"
      [options]="hourlyErrorChartOptions"
      type="bar"
      (chartClick)="onChartClick($event, 'hourly')">
    </canvas>
  </div>
  <div class="chart">
    <h3>ユーザー別エラー発生数</h3>
    <canvas baseChart
      [data]="userImpactChartData"
      [options]="userImpactChartOptions"
      type="bar"
      (chartClick)="onChartClick($event, 'userImpact')">
    </canvas>
  </div>
</div> 