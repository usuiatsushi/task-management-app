<div class="task-list-container">
  <div class="task-list-header">
    <h1>タスク一覧</h1>
    <button mat-raised-button color="primary" (click)="navigateToNewTask()">
      <mat-icon>add</mat-icon>
      新規タスク
    </button>
  </div>

  <form [formGroup]="filterForm" class="filters">
    <mat-form-field appearance="outline">
      <mat-label>カテゴリ</mat-label>
      <mat-select formControlName="category">
        <mat-option value="">すべて</mat-option>
        <mat-option *ngFor="let category of getUniqueCategories()" [value]="category">
          {{ category }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>ステータス</mat-label>
      <mat-select formControlName="status">
        <mat-option value="">すべて</mat-option>
        <mat-option value="未着手">未着手</mat-option>
        <mat-option value="進行中">進行中</mat-option>
        <mat-option value="完了">完了</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>優先度</mat-label>
      <mat-select formControlName="priority">
        <mat-option value="">すべて</mat-option>
        <mat-option value="低">低</mat-option>
        <mat-option value="中">中</mat-option>
        <mat-option value="高">高</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>検索</mat-label>
      <input matInput [formControl]="searchControl" placeholder="タスクを検索">
    </mat-form-field>

    <button mat-button color="primary" (click)="resetFilters()">フィルターをリセット</button>
  </form>

  <div class="table-container">
    <table mat-table [dataSource]="dataSource" matSort>
      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>タイトル</th>
        <td mat-cell *matCellDef="let task">{{ task.title }}</td>
      </ng-container>

      <ng-container matColumnDef="category">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>カテゴリ</th>
        <td mat-cell *matCellDef="let task">{{ task.category }}</td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>ステータス</th>
        <td mat-cell *matCellDef="let task">
          <span class="status-badge" [class]="getStatusClass(task.status)">{{ task.status }}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="priority">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>優先度</th>
        <td mat-cell *matCellDef="let task">
          <span class="priority-badge" [class]="getPriorityClass(task.priority)">{{ task.priority }}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="dueDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>期限</th>
        <td mat-cell *matCellDef="let task">{{ task.dueDate?.toDate() | date:'yyyy/MM/dd' }}</td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>操作</th>
        <td mat-cell *matCellDef="let task">
          <div class="action-buttons">
            <button mat-button color="primary" (click)="viewTask(task)">詳細</button>
            <button mat-icon-button color="warn" (click)="deleteTask(task, $event)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="viewTask(row)"></tr>
    </table>

    <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" aria-label="ページを選択"></mat-paginator>
  </div>

  <div class="loading-spinner" *ngIf="loading">
    <mat-spinner></mat-spinner>
  </div>
</div> 